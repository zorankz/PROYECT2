<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Área Premium</title>
  <!-- External Resources -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #6c5ce7;
      --primary-light: #a29bfe;
      --secondary: #00cec9;
      --dark: #2d3436;
      --light: #f5f6fa;
      --success: #00b894;
      --warning: #fdcb6e;
      --danger: #d63031;
      --text: #636e72;
      --card-bg: rgba(255, 255, 255, 0.9);
      --blur-bg: rgba(255, 255, 255, 0.15);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: var(--dark);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* App Container - Nuevo diseño móvil primero */
    .app-container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      position: relative;
    }

    /* Header móvil */
    .mobile-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background: var(--primary);
      color: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 100;
      position: sticky;
      top: 0;
    }

    .menu-toggle {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
    }

    .mobile-title {
      font-weight: 600;
      font-size: 1.2rem;
      animation: fadeIn 0.5s ease;
    }

    /* Sidebar - Rediseñado para móvil */
    .sidebar {
      position: fixed;
      top: 0;
      left: -100%;
      width: 80%;
      max-width: 300px;
      height: 100vh;
      background: white;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      z-index: 1000;
      transition: var(--transition);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .sidebar.active {
      left: 0;
      animation: slideIn 0.3s ease;
    }

    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 999;
      opacity: 0;
      pointer-events: none;
      transition: var(--transition);
    }

    .sidebar-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .profile {
      padding: 2rem 1rem 1rem;
      text-align: center;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      position: relative;
    }

    .profile-pic {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid white;
      box-shadow: var(--shadow);
      transition: var(--transition);
    }

    .profile-pic:hover {
      transform: scale(1.05);
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }

    .profile h3 {
      margin-top: 0.5rem;
      font-size: 1.2rem;
    }

    .profile small {
      display: inline-block;
      padding: 0.2rem 0.5rem;
      background: rgba(255,255,255,0.2);
      border-radius: 20px;
      font-size: 0.7rem;
      margin-top: 0.3rem;
    }

    .nav-menu {
      display: flex;
      flex-direction: column;
      padding: 1rem 0;
      flex-grow: 1;
    }

    .nav-item {
      display: flex;
      align-items: center;
      padding: 1rem 1.5rem;
      background: none;
      border: none;
      color: var(--text);
      font-size: 0.95rem;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .nav-item::before {
      content: '';
      position: absolute;
      left: -100%;
      top: 0;
      width: 100%;
      height: 100%;
      background: var(--primary-light);
      opacity: 0.1;
      transition: var(--transition);
    }

    .nav-item:hover {
      color: var(--primary);
      background: rgba(108, 92, 231, 0.05);
    }

    .nav-item:hover::before {
      left: 0;
    }

    .nav-item.active {
      color: var(--primary);
      background: rgba(108, 92, 231, 0.1);
    }

    .nav-item.active::before {
      left: 0;
      background: var(--primary);
      opacity: 0.2;
    }

    .nav-item i {
      margin-right: 1rem;
      font-size: 1.1rem;
      width: 24px;
      text-align: center;
    }

    /* Main Content - Rediseñado para móvil */
    .main-content {
      flex-grow: 1;
      padding: 1rem;
      transition: var(--transition);
    }

    .content-panel {
      display: none;
      animation: fadeInUp 0.5s ease;
    }

    .content-panel.active {
      display: block;
    }

    /* Welcome Message */
    #welcome-box {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 9999;
      background: var(--blur-bg);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 1;
      transition: opacity 0.5s ease;
    }

    #welcome-box.fade-out {
      opacity: 0;
      pointer-events: none;
    }

    .welcome-content {
      background: white;
      padding: 2rem;
      border-radius: 16px;
      text-align: center;
      box-shadow: var(--shadow);
      transform: scale(0.9);
      animation: popIn 0.5s ease forwards;
    }

    .welcome-icon {
      font-size: 3rem;
      color: var(--primary);
      margin-bottom: 1rem;
      animation: bounce 2s infinite;
    }

    /* Chat Panel - Rediseñado */
    .chat-container {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 120px);
      background: white;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    .chat-header {
      padding: 1rem;
      background: var(--primary);
      color: white;
      text-align: center;
    }

    .chat-header h2 {
      font-size: 1.2rem;
    }

    .chat-body {
      flex-grow: 1;
      padding: 1rem;
      overflow-y: auto;
      background: #f5f6fa;
    }

    .message {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 18px;
      margin-bottom: 1rem;
      position: relative;
      animation: messageIn 0.3s ease-out forwards;
      opacity: 0;
      transform: translateY(10px);
      font-size: 0.9rem;
      line-height: 1.4;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }

    .message.received {
      background: white;
      border-bottom-left-radius: 4px;
      margin-right: auto;
    }

    .message.sent {
      background: var(--primary);
      color: white;
      border-bottom-right-radius: 4px;
      margin-left: auto;
    }

    .message-time {
      display: block;
      font-size: 0.7rem;
      opacity: 0.7;
      margin-top: 4px;
      text-align: right;
    }

    .message.sent .message-time {
      color: rgba(255,255,255,0.7);
    }

    .chat-input-container {
      padding: 1rem;
      background: white;
      border-top: 1px solid #eee;
    }

    .chat-input {
      display: flex;
      background: #f5f6fa;
      border-radius: 30px;
      overflow: hidden;
    }

    .chat-input input {
      flex-grow: 1;
      border: none;
      background: transparent;
      padding: 0.8rem 1rem;
      outline: none;
    }

    .chat-input button {
      background: none;
      border: none;
      padding: 0 1rem;
      color: var(--primary);
      cursor: pointer;
      transition: var(--transition);
    }

    .chat-input button:hover {
      transform: scale(1.1);
    }

    /* Info Panel - Tarjetas rediseñadas */
    .info-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    .info-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 1.2rem;
      box-shadow: var(--shadow);
      transition: var(--transition);
      animation: fadeInUp 0.5s ease;
      animation-fill-mode: both;
    }

    .info-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }

    .info-card h3 {
      font-size: 0.9rem;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }

    .info-card p {
      font-size: 1rem;
      font-weight: 500;
    }

    /* Progress Panel - Rediseñado */
    .progress-container {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: var(--shadow);
      margin-bottom: 1rem;
    }

    .progress-description {
      color: var(--text);
      margin-bottom: 1rem;
      font-size: 0.9rem;
    }

    .progress-wrapper {
      margin-bottom: 1.5rem;
    }

    .progress-title {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }

    .progress-bar {
      height: 10px;
      background: #eee;
      border-radius: 10px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border-radius: 10px;
      transition: width 1s ease;
      position: relative;
      overflow: hidden;
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, 
        rgba(255,255,255,0.1) 0%, 
        rgba(255,255,255,0.3) 50%, 
        rgba(255,255,255,0.1) 100%);
      animation: shimmer 2s infinite linear;
    }

    .progress-text {
      font-size: 0.9rem;
      color: var(--text);
      margin-top: 0.5rem;
      text-align: center;
    }

    /* Steps Animation */
    #progress-steps {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      padding: 1rem;
      position: relative;
    }

    #progress-steps::before {
      content: '';
      position: absolute;
      top: 0;
      bottom: 0;
      left: 25px;
      width: 4px;
      background: linear-gradient(to bottom, #e0e0e0, #e0e0e0);
      z-index: 1;
      border-radius: 4px;
    }

    .step {
      display: flex;
      gap: 1rem;
      position: relative;
      z-index: 2;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .step.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .step-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      flex-shrink: 0;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      cursor: pointer;
      position: relative;
    }

    .step-icon::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 2px solid transparent;
      top: 0;
      left: 0;
      transition: all 0.3s ease;
    }

    .step-info {
      flex-grow: 1;
      padding-bottom: 1.5rem;
    }

    .step-info h3 {
      margin: 0 0 0.3rem 0;
      font-size: 1rem;
      color: #333;
      font-weight: 600;
    }

    .step-info p {
      margin: 0;
      font-size: 0.85rem;
      color: #666;
    }

    .step.pending .step-icon {
      background: linear-gradient(135deg, #fff3cd, #ffecb3);
      color: #ffb300;
      border: 3px solid #ffc107;
    }

    .step.current .step-icon {
      background: linear-gradient(135deg, #cce5ff, #a3d0ff);
      color: #0062cc;
      border: 3px solid #007bff;
      animation: pulseSpin 2s infinite ease-in-out;
    }

    .step.completed .step-icon {
      background: linear-gradient(135deg, #d4edda, #b8e0c1);
      color: #218838;
      border: 3px solid #28a745;
    }

    /* Dependientes Panel - Rediseñado */
    .dependientes-header {
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }

    .section-subtitle {
      color: var(--text);
      font-size: 0.9rem;
    }

    .milestone-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow);
      animation: fadeInUp 0.5s ease;
    }

    .form-title {
      font-size: 1.1rem;
      font-weight: 500;
      margin-bottom: 1rem;
      color: var(--primary);
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .input-label {
      display: block;
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: var(--dark);
      font-size: 0.9rem;
    }

    .input-field {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 0.95rem;
      transition: var(--transition);
      background: rgba(255,255,255,0.8);
    }

    .input-field:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.2);
      outline: none;
    }

    .input-hint {
      display: block;
      font-size: 0.75rem;
      color: var(--text);
      margin-top: 0.25rem;
      opacity: 0.7;
    }

    .btn-primary {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      width: 100%;
      box-shadow: 0 4px 6px rgba(108, 92, 231, 0.2);
    }

    .btn-primary:hover {
      background-color: #5a4bd1;
      transform: translateY(-2px);
      box-shadow: 0 6px 10px rgba(108, 92, 231, 0.3);
    }

    .dependientes-list-container {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: var(--shadow);
      animation: fadeInUp 0.5s ease;
    }

    .list-title {
      font-size: 1.1rem;
      font-weight: 500;
      margin-bottom: 1rem;
      color: var(--dark);
    }

    .empty-state {
      text-align: center;
      padding: 2rem;
      color: var(--text);
      animation: fadeIn 0.5s ease;
    }

    .empty-state i {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: #bdc3c7;
    }

    .dependiente-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      border-bottom: 1px solid #eee;
      transition: var(--transition);
      animation: fadeIn 0.5s ease;
    }

    .dependiente-item:last-child {
      border-bottom: none;
    }

    .dependiente-item:hover {
      background: rgba(0,0,0,0.02);
    }

    .dependiente-info {
      display: flex;
      flex-direction: column;
      flex-grow: 1;
    }

    .dependiente-nombre {
      font-weight: 500;
      margin-bottom: 0.25rem;
      color: var(--dark);
    }

    .dependiente-details {
      font-size: 0.85rem;
      color: var(--text);
    }

    .btn-icon {
      background: none;
      border: none;
      color: var(--danger);
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }

    .btn-icon:hover {
      background-color: rgba(214, 48, 49, 0.1);
    }

    /* Pagos Panel - Rediseñado */
    .pago-step {
      background-color: #f5faff;
      border-left: 5px solid var(--primary);
      padding: 1rem;
      border-radius: 8px;
      position: relative;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      margin-bottom: 1rem;
      animation: fadeInUp 0.5s ease;
    }

    .pago-step h3 {
      margin: 0 0 0.5rem 0;
      color: var(--primary);
      font-size: 1.1rem;
    }

    .pago-step p {
      margin: 0.3rem 0;
      font-size: 0.9rem;
    }

    .estado-pago span {
      font-weight: bold;
    }

    .btn-comprobante {
      margin-top: 0.8rem;
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.9rem;
      width: 100%;
    }

    .btn-comprobante:hover {
      background-color: #5a4bd1;
    }

    .input-comprobante {
      width: 100%;
      margin-top: 0.5rem;
      font-size: 0.8rem;
    }

    /* Modal de foto */
    .modal-foto {
      display: none;
      justify-content: center;
      align-items: center;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.9);
      animation: fadeIn 0.3s ease;
    }

    .modal-foto.activo {
      display: flex;
    }

    .contenido-modal {
      max-width: 90%;
      max-height: 80%;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(255,255,255,0.2);
      animation: zoomIn 0.3s ease;
    }

    .cerrar-modal {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 30px;
      color: white;
      cursor: pointer;
      transition: var(--transition);
    }

    .cerrar-modal:hover {
      transform: rotate(90deg);
    }

    /* Modal de archivos */
    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
      animation: fadeIn 0.3s ease;
    }

    .modal-content {
      background: white;
      margin: 10% auto;
      padding: 1.5rem;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      box-shadow: var(--shadow);
      animation: slideUp 0.3s ease;
    }

    .close-modal {
      color: #aaa;
      float: right;
      font-size: 1.5rem;
      font-weight: bold;
      cursor: pointer;
      transition: var(--transition);
    }

    .close-modal:hover {
      color: var(--danger);
      transform: rotate(90deg);
    }

    .file-uploader {
      margin: 1rem 0;
    }

    .drop-area {
      border: 2px dashed #ddd;
      border-radius: 8px;
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
    }

    .drop-area:hover {
      border-color: var(--primary);
      background: rgba(108, 92, 231, 0.05);
    }

    .drop-area i {
      font-size: 2rem;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }

    .btn-select-file {
      background: var(--primary);
      color: white;
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 6px;
      margin-top: 1rem;
      cursor: pointer;
      transition: var(--transition);
    }

    .btn-select-file:hover {
      background: #5a4bd1;
    }

    .file-preview {
      margin-top: 1rem;
      text-align: center;
    }

    .preview-image img {
      max-width: 100%;
      max-height: 150px;
      border-radius: 8px;
      margin-bottom: 0.5rem;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .modal-actions button {
      padding: 0.6rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      transition: var(--transition);
    }

    .btn-cancel {
      background: #f1f1f1;
      border: 1px solid #ddd;
    }

    .btn-cancel:hover {
      background: #e0e0e0;
    }

    .btn-send {
      background: var(--primary);
      color: white;
      border: none;
    }

    .btn-send:hover {
      background: #5a4bd1;
    }

    /* Animaciones */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes fadeInUp {
      from { 
        opacity: 0;
        transform: translateY(20px);
      }
      to { 
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideIn {
      from { transform: translateX(-100%); }
      to { transform: translateX(0); }
    }

    @keyframes popIn {
      0% { transform: scale(0.9); opacity: 0; }
      80% { transform: scale(1.05); }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes messageIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulseSpin {
      0% { transform: scale(1) rotate(0deg); }
      50% { transform: scale(1.1) rotate(5deg); }
      100% { transform: scale(1) rotate(0deg); }
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    @keyframes zoomIn {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    @keyframes slideUp {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* Responsive adjustments */
    @media (min-width: 768px) {
      .app-container {
        flex-direction: row;
      }
      
      .mobile-header {
        display: none;
      }
      
      .sidebar {
        position: relative;
        left: 0;
        width: 280px;
        height: 100vh;
        flex-shrink: 0;
      }
      
      .sidebar-overlay {
        display: none;
      }
      
      .main-content {
        flex-grow: 1;
        height: 100vh;
        overflow-y: auto;
      }
      
      .info-container {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .step-icon {
        width: 60px;
        height: 60px;
        font-size: 1.8rem;
      }
      
      #progress-steps::before {
        left: 30px;
      }
    }

    @media (min-width: 992px) {
      .info-container {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .form-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Mobile Header -->
    <header class="mobile-header">
      <button class="menu-toggle" id="menu-toggle">
        <i class="fas fa-bars"></i>
      </button>
      <h1 class="mobile-title" id="mobile-title">Área Premium</h1>
      <div style="width: 40px;"></div> <!-- Espacio para alinear -->
    </header>

    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
      <div class="profile">
        <img id="client-photo" src="https://i.pravatar.cc/150?img=32" alt="Foto de perfil" class="profile-pic">
        <h3 id="client-name">Alex Johnson</h3>
        <p id="client-status">Cliente Premium</p>
        <small class="status">En línea</small>
      </div>

      <nav class="nav-menu">
        <button class="nav-item active" data-view="chat">
          <i class="fas fa-comment-dots"></i>
          <span>Chat</span>
        </button>
        <button class="nav-item" data-view="info">
          <i class="fas fa-user"></i>
          <span>Mi Información</span>
        </button>
        <button class="nav-item" data-view="documentos">
          <i class="fas fa-folder"></i>
          <span>Documentos</span>
        </button>
        <button class="nav-item" data-view="progreso">
          <i class="fas fa-chart-line"></i>
          <span>Mi Progreso</span>
        </button>
        <button class="nav-item" data-view="dependientes">
          <i class="fas fa-users"></i>
          <span>Dependientes</span>
        </button>
        <button class="nav-item" data-view="pagos">
          <i class="fas fa-credit-card"></i>
          <span>Pagos</span>
        </button>
      </nav>
    </aside>

    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <!-- Main Content Area -->
    <main class="main-content">
      <!-- Welcome Message -->
      <div class="welcome-message" id="welcome-box">
        <div class="welcome-content">
          <i class="fas fa-user-circle welcome-icon"></i>
          <h2>Bienvenido a tu Área Privada</h2>
          <p>Selecciona una opción del menú para comenzar</p>
        </div>
      </div>

      <!-- Chat Panel -->
      <section id="vista-chat" class="content-panel active">
        <div class="chat-container">
          <div class="chat-header">
            <h2>Conversación con tu Asesor</h2>
          </div>
          
          <div class="chat-body" id="chat-body">
            <div id="messages-container">
              <div class="welcome-chat-message">
                <div class="message received">
                  ¡Hola <span id="client-name-chat">Alex</span>! ¿En qué puedo ayudarte hoy?
                  <span class="message-time">10:30 AM</span>
                </div>
                <p class="chat-instructions">Escribe tu mensaje en el cuadro de abajo para comenzar la conversación</p>
              </div>
            </div>
          </div>
          
          <div class="chat-input-container">
            <div class="chat-input">
              <input type="text" id="chat-message" placeholder="Escribe tu mensaje...">
              <button class="file-btn" id="file-btn" title="Adjuntar archivo">
                <i class="fas fa-paperclip"></i>
              </button>
              <button class="send-btn" id="send-btn" title="Enviar mensaje">
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Information Panel -->
      <section id="vista-info" class="content-panel">
        <div class="info-container">
          <div class="info-card">
            <h3>Nombre Completo</h3>
            <p id="info-nombre">Cargando...</p>
          </div>
          <div class="info-card">
            <h3>Correo Electrónico</h3>
            <p id="info-email">Cargando...</p>
          </div>
          <div class="info-card">
            <h3>Teléfono</h3>
            <p id="info-phone">Cargando...</p>
          </div>
          <div class="info-card">
            <h3>ID de Cliente</h3>
            <p id="info-id">Cargando...</p>
          </div>
          <div class="info-card">
            <h3>Dirección</h3>
            <p id="info-direccion">Cargando...</p>
          </div>
          <div class="info-card">
            <h3>Número A</h3>
            <p id="info-numeroA">Cargando...</p>
          </div>
          <div class="info-card">
            <h3>Fecha de Registro</h3>
            <p id="info-registro">Cargando...</p>
          </div>
          <div class="info-card">
            <h3>Cuenta USCIS</h3>
            <p id="info-uscis">Cargando...</p>
          </div>
          <div class="info-card">
            <h3>Contraseña</h3>
            <p id="info-password">Cargando...</p>
          </div>
          <div class="info-card">
            <h3>Código de Respaldo</h3>
            <p id="info-codigo">Cargando...</p>
          </div>
          <div class="info-card">
            <h3>Tipo de Proceso</h3>
            <p id="info-proceso">Cargando...</p>
          </div>
        </div>
      </section>

      <!-- Documents Panel -->
      <section id="vista-documentos" class="content-panel">
        <div class="progress-container">
          <h2>Mis Documentos</h2>
          <p class="progress-description">Aquí encontrarás todos los documentos relacionados con tu caso</p>
          
          <div class="documents-list" id="documents-list">
            <div class="empty-state">
              <i class="fas fa-folder-open"></i>
              <p>No hay documentos disponibles</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Progress Panel -->
      <section id="vista-progreso" class="content-panel">
        <div class="progress-container">
          <h2>Progreso de mi Caso</h2>
          <p class="progress-description">Aquí puedes ver el avance de tu proceso</p>
          
          <div class="progress-wrapper">
            <div class="progress-title">
              <span>Completado</span>
              <span id="progress-percent">0%</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
            <p class="progress-text" id="progress-text">El proceso comenzará una vez completado el registro y pago.</p>
          </div>
          
          <div class="progress-steps" id="progress-steps">
            <!-- Los hitos se agregarán dinámicamente aquí -->
          </div>
        </div>
      </section>

      <!-- Dependientes Panel -->
      <section id="vista-dependientes" class="content-panel">
        <div class="dependientes-header">
          <h2 class="section-title">Mis Dependientes</h2>
          <p class="section-subtitle">Administra los familiares incluidos en tu caso</p>
        </div>

        <div class="milestone-card">
          <h3 class="form-title">Añadir nuevo dependiente</h3>
          
          <div class="form-group">
            <label for="dep-nombre" class="input-label">Nombre completo</label>
            <input type="text" id="dep-nombre" class="input-field" placeholder="Ej: María González Pérez" required>
            <span class="input-hint">Nombre legal como aparece en documentos</span>
          </div>
          
          <div class="form-group">
            <label for="dep-fecha" class="input-label">Fecha de Nacimiento</label>
            <input type="date" id="dep-fecha" class="input-field" required>
            <span class="input-hint">Formato: DD/MM/AAAA</span>
          </div>
          
          <div class="form-group">
            <label for="dep-alien" class="input-label">Número de Alien</label>
            <input type="text" id="dep-alien" class="input-field" placeholder="Ej: A123456789" pattern="[A-Za-z]\d{9}" required>
            <span class="input-hint">Letra seguida de 9 dígitos</span>
          </div>
          
          <button type="button" class="btn-primary" onclick="agregarDependiente()">
            <i class="fas fa-user-plus"></i> Añadir Dependiente
          </button>
        </div>

        <div class="dependientes-list-container">
          <h3 class="list-title">Tus dependientes registrados</h3>
          
          <div class="dependientes-list" id="dependientes-lista">
            <div class="empty-state">
              <i class="fas fa-users-slash"></i>
              <p>No has agregado dependientes aún</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Pagos Panel -->
      <section id="vista-pagos" class="content-panel">
        <div class="progress-container">
          <h2>Plan de Pagos</h2>
          <p class="progress-description">Aquí verás los pagos asignados por tu asesor. Sube un comprobante por cada pago realizado.</p>
      
          <div class="progress-wrapper">
            <div class="progress-title">
              <span>Pagos Realizados</span>
              <span id="pago-progress-percent">0%</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" id="pago-progress-fill" style="width: 0%; background-color: var(--success);"></div>
            </div>
          </div>
      
          <div class="progress-container" id="lista-pagos">
            <div class="empty-state">
              <i class="fas fa-money-check-alt"></i>
              <p>No hay pagos programados aún</p>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- MODAL PARA AMPLIAR FOTO -->
  <div id="modal-foto" class="modal-foto">
    <span class="cerrar-modal">&times;</span>
    <img id="foto-ampliada" class="contenido-modal" src="" alt="Foto ampliada">
  </div>

  <!-- File Upload Modal -->
  <div id="file-modal" class="modal">
    <div class="modal-content">
      <span class="close-modal">&times;</span>
      <h3>Seleccionar Archivo</h3>
      <div class="file-uploader">
        <input type="file" id="file-input" hidden>
        <div class="drop-area" id="drop-area">
          <i class="fas fa-cloud-upload-alt"></i>
          <p>Arrastra tu archivo aquí o haz clic para seleccionar</p>
          <button class="btn-select-file">Seleccionar Archivo</button>
        </div>
        <div class="file-preview" id="file-preview"></div>
      </div>
      <div class="modal-actions">
        <button class="btn-cancel">Cancelar</button>
        <button class="btn-send" disabled>Enviar Archivo</button>
      </div>
    </div>
  </div>

  <!-- JavaScript Resources -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    // Al inicio de tu script
    const urlParams = new URLSearchParams(window.location.search);
    const clienteId = urlParams.get('id');

    // Validación temprana
    if (!clienteId) {
      console.error('No se proporcionó ID de cliente');
      window.location.href = 'login-cliente.html';
      throw new Error('Ejecución detenida: sin ID de cliente');
    }

    console.log('Cliente ID:', clienteId);

    // Configuración del menú móvil
    const menuToggle = document.getElementById('menu-toggle');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebar-overlay');

    menuToggle.addEventListener('click', () => {
      sidebar.classList.add('active');
      sidebarOverlay.classList.add('active');
    });

    sidebarOverlay.addEventListener('click', () => {
      sidebar.classList.remove('active');
      sidebarOverlay.classList.remove('active');
    });

    // Ahora puedes usar clienteId con seguridad
    const socket = io('https://proyect2-1.onrender.com/');

    socket.on('connect', () => {
      console.log('🟢 Conectado al servidor:', socket.id);
      socket.emit('unirse', clienteId);
      cargarDatosDelCliente();
      cargarMensajesDelCliente(clienteId);
      cargarProgresoDelCliente(clienteId);
    });

    socket.on('disconnect', () => {
      console.log('🔴 Desconectado del servidor');
    });

    socket.on('progreso-actualizado', () => {
      console.log('📈 Progreso actualizado recibido del servidor');
      cargarProgresoDelCliente(clienteId);
      
      // Animación de la barra de progreso
      const barra = document.getElementById('progress-fill');
      if (barra) {
        barra.style.transition = 'none';
        barra.style.width = '0%';
        setTimeout(() => {
          barra.style.transition = 'width 1s ease';
          cargarProgresoDelCliente(clienteId);
        }, 50);
      }
    });

    let mensajesCargados = new Set();

    function scrollToBottom() {
      const container = document.getElementById('chat-body');
      if (container) {
        setTimeout(() => {
          container.scrollTop = container.scrollHeight;
        }, 50);
      }
    }

    // Escuchar mensajes del ASESOR
    socket.on('mensaje-asesor', (mensaje) => {
      const container = document.getElementById('messages-container');
      const msgId = mensaje._id || mensaje.fecha;

      if (!mensajesCargados.has(msgId)) {
        const msgEl = document.createElement('div');
        msgEl.className = 'message received';
        msgEl.innerHTML = `
          ${mensaje.texto}
          <span class="message-time">
            ${new Date(mensaje.fecha).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
          </span>
        `;
        container.appendChild(msgEl);
        mensajesCargados.add(msgId);
        scrollToBottom();
      }
    });

    // Client Data Functions
    async function cargarPagosCliente(cliente) {
      const pagos = cliente.pagos || [];
      const lista = document.getElementById('lista-pagos');
      lista.innerHTML = '';

      if (pagos.length === 0) {
        lista.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-money-check-alt"></i>
            <p>No hay pagos programados aún</p>
          </div>`;
        return;
      }

      let pagados = 0;

      pagos.forEach((pago, index) => {
        const esPagado = pago.estado?.toLowerCase() === 'pagado';
        if (esPagado) pagados++;

        const card = document.createElement('div');
        card.className = 'pago-step';
        card.innerHTML = `
          <h3>Pago ${index + 1}</h3>
          <p><strong>Monto:</strong> $${pago.monto}</p>
          <p><strong>Fecha:</strong> ${pago.fecha || 'No especificada'}</p>
          <p class="estado-pago"><strong>Estado:</strong> <span style="color: ${esPagado ? 'var(--success)' : 'var(--warning)'}">${pago.estado}</span></p>
          ${
            !esPagado
              ? `<input type="file" id="comprobante-${index}" class="input-comprobante">
                 <button class="btn-comprobante" onclick="subirComprobante('${cliente.id}', ${index})">Subir Comprobante</button>`
              : `<span style="color: var(--success);">✔️ Comprobante confirmado</span>`
          }
        `;
        lista.appendChild(card);
      });

      // Barra de progreso de pagos con animación
      const porcentaje = Math.round((pagados / pagos.length) * 100);
      const barraPagos = document.getElementById('pago-progress-fill');
      barraPagos.style.transition = 'none';
      barraPagos.style.width = '0%';
      
      setTimeout(() => {
        barraPagos.style.transition = 'width 1s ease';
        barraPagos.style.width = `${porcentaje}%`;
        document.getElementById('pago-progress-percent').textContent = `${porcentaje}%`;
      }, 50);
    }

    async function cargarDatosDelCliente() {
      try {
        const res = await fetch(`https://proyect2-1.onrender.com/clientes/${clienteId}`);
        const cliente = await res.json();
        
        if (!cliente || Object.keys(cliente).length === 0) {
          throw new Error('Datos del cliente vacíos');
        }
        
        actualizarInterfazCliente(cliente);
        cargarArchivosDelCliente(clienteId);
        cargarPagosCliente(cliente);
        
        return cliente;
      } catch (err) {
        console.error('❌ Error al cargar datos del cliente:', err);
        mostrarError(err.message);
        return null;
      }
    }

    function actualizarInterfazCliente(cliente) {
      const setText = (id, texto) => {
        const el = document.getElementById(id);
        if (el) el.textContent = texto || 'No disponible';
      };
      
      setText('client-name', cliente.nombre);
      setText('client-name-chat', cliente.nombre);
      
      setText('info-nombre', cliente.nombre);
      setText('info-email', cliente.correo);
      setText('info-phone', cliente.telefono);
      setText('info-id', cliente.id);
      setText('info-direccion', cliente.direccion);
      setText('info-numeroA', cliente.numeroA);
      setText('info-registro', new Date(cliente.fechaCreacion).toLocaleDateString());
      setText('info-uscis', cliente.uscis);
      setText('info-password', cliente.contrasena);
      setText('info-codigo', cliente.codigoRespaldo);
      setText('info-proceso', cliente.proceso);

      // Foto
      if (cliente.foto) {
        const img = document.getElementById('client-photo');
        if (img) img.src = cliente.foto;
      }
    }

    function mostrarError(mensaje) {
      const errorBox = document.createElement('div');
      errorBox.style.position = 'fixed';
      errorBox.style.top = '20px';
      errorBox.style.left = '50%';
      errorBox.style.transform = 'translateX(-50%)';
      errorBox.style.backgroundColor = 'var(--danger)';
      errorBox.style.color = 'white';
      errorBox.style.padding = '12px 20px';
      errorBox.style.borderRadius = '8px';
      errorBox.style.zIndex = '1000';
      errorBox.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
      errorBox.style.display = 'flex';
      errorBox.style.alignItems = 'center';
      errorBox.style.gap = '10px';
      errorBox.style.animation = 'slideDown 0.3s ease';
      errorBox.innerHTML = `
        <i class="fas fa-exclamation-circle"></i>
        <span>${mensaje}</span>
      `;
      
      document.body.appendChild(errorBox);
      
      setTimeout(() => {
        errorBox.style.animation = 'fadeOut 0.5s ease';
        setTimeout(() => errorBox.remove(), 500);
      }, 5000);
    }

    // Ampliar foto de perfil
    const imgPerfil = document.querySelector('#client-photo');
    const modalFoto = document.querySelector('#modal-foto');
    const fotoAmpliada = document.querySelector('#foto-ampliada');
    const cerrarModal = document.querySelector('.cerrar-modal');

    imgPerfil.addEventListener('click', () => {
      fotoAmpliada.src = imgPerfil.src;
      modalFoto.classList.add('activo');
    });

    cerrarModal.addEventListener('click', () => {
      modalFoto.classList.remove('activo');
    });

    modalFoto.addEventListener('click', (e) => {
      if (e.target === modalFoto) {
        modalFoto.classList.remove('activo');
      }
    });

    async function cargarMensajesDelCliente(id) {
      if (!id) {
        console.error("ID de cliente no proporcionado");
        return;
      }

      try {
        const res = await fetch(`https://proyect2-1.onrender.com/mensajes/${id}`);
        const mensajes = await res.json();
        const messagesContainer = document.getElementById('messages-container');
        
        if (!messagesContainer) {
          console.error('Contenedor de mensajes no encontrado');
          return;
        }

        messagesContainer.innerHTML = '';
        mensajesCargados.clear();

        if (!Array.isArray(mensajes) || mensajes.length === 0) {
          const welcomeMsg = document.createElement('div');
          welcomeMsg.className = 'welcome-chat-message';
          welcomeMsg.innerHTML = `
            <div class="message received">
              ¡Hola <span id="client-name-chat">Cliente</span>! ¿En qué puedo ayudarte hoy?
              <span class="message-time">${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>
            </div>
            <p class="chat-instructions">Escribe tu mensaje en el cuadro de abajo para comenzar la conversación</p>
          `;
          messagesContainer.appendChild(welcomeMsg);
          return;
        }

        mensajes.forEach(msg => {
          const msgId = msg._id ? `msg-${msg._id}` : `temp-${Date.parse(msg.fecha)}`;

          if (!mensajesCargados.has(msgId)) {
            const msgEl = document.createElement('div');
            msgEl.className = 'message ' + (msg.autor === 'cliente' ? 'sent' : 'received');
            msgEl.innerHTML = `
              ${msg.texto || 'Mensaje sin texto'}
              <span class="message-time">
                ${new Date(msg.fecha).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
              </span>
            `;
            messagesContainer.appendChild(msgEl);
            mensajesCargados.add(msgId);
          }
        });

        scrollToBottom();
      } catch (err) {
        console.error("Error cargando mensajes:", err);
        mostrarError("No se pudieron cargar los mensajes");
      }
    }

    async function cargarArchivosDelCliente(id) {
      try {
        const res = await fetch(`https://proyect2-1.onrender.com/archivos/${id}`);
        const archivos = await res.json();
        const lista = document.getElementById('documents-list');
        lista.innerHTML = '';

        if (archivos.length === 0) {
          lista.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-folder-open"></i>
              <p>No hay documentos disponibles</p>
            </div>`;
          return;
        }

        archivos.forEach(file => {
          const card = document.createElement('div');
          card.className = 'info-card';
          card.style.cursor = 'pointer';
          card.style.transition = 'transform 0.3s ease';
          
          const isPDF = file.nombre.toLowerCase().endsWith('.pdf');
          const icon = isPDF
            ? `<i class="fas fa-file-pdf" style="font-size: 2rem; color: var(--danger); margin-bottom: 0.5rem;"></i>`
            : `<i class="fas fa-file" style="font-size: 2rem; color: var(--primary); margin-bottom: 0.5rem;"></i>`;

          card.innerHTML = `
            <div style="text-align: center;">
              ${icon}
              <p style="font-weight: 500; margin-bottom: 0.5rem;">${file.nombre}</p>
              <a href="${file.base64}" download="${file.nombre}" class="btn-primary" style="padding: 0.5rem; font-size: 0.8rem;">
                <i class="fas fa-download"></i> Descargar
              </a>
            </div>
          `;

          card.addEventListener('click', () => {
            card.style.transform = 'scale(0.95)';
            setTimeout(() => card.style.transform = 'scale(1)', 200);
          });

          lista.appendChild(card);
        });
      } catch (err) {
        console.error("Error cargando archivos:", err);
      }
    }

    // Funciones para manejar el progreso del cliente
    async function cargarProgresoDelCliente(id) {
      try {
        const res = await fetch(`https://proyect2-1.onrender.com/progreso/${id}`);
        const progreso = await res.json();
        
        if (progreso && progreso.hitos) {
          renderizarHitos(progreso.hitos);
          actualizarBarraProgreso(progreso.hitos);
        } else {
          renderizarHitos([]);
          actualizarBarraProgreso([]);
        }
      } catch (err) {
        console.error("Error cargando progreso:", err);
        renderizarHitos([]);
        actualizarBarraProgreso([]);
      }
    }

    function renderizarHitos(hitos) {
      const container = document.getElementById('progress-steps');
      container.innerHTML = '';

      if (hitos.length === 0) {
        container.innerHTML = `
          <div class="empty-state" style="padding: 1rem;">
            <i class="fas fa-tasks"></i>
            <p>No hay hitos registrados aún</p>
          </div>`;
        return;
      }

      hitos.forEach((hito, index) => {
        const estadoOriginal = hito.estado?.toLowerCase() || 'pendiente';
        let estadoClase = 'pending';
        let icon = '<i class="fas fa-clock"></i>';
        
        if (estadoOriginal.includes('completado') || estadoOriginal.includes('completed')) {
          estadoClase = 'completed';
          icon = '<i class="fas fa-check-circle"></i>';
        } else if (estadoOriginal.includes('proceso') || estadoOriginal.includes('current')) {
          estadoClase = 'current';
          icon = '<i class="fas fa-spinner fa-spin"></i>';
        }

        const step = document.createElement('div');
        step.className = `step ${estadoClase}`;
        step.style.animationDelay = `${index * 0.1}s`;

        step.innerHTML = `
          <div class="step-icon">${icon}</div>
          <div class="step-info">
            <h3>${hito.nombre}</h3>
            <p>${hito.fecha || 'Sin fecha'}</p>
            ${hito.descripcion ? `<small style="color: var(--text); font-size: 0.8rem;">${hito.descripcion}</small>` : ''}
          </div>
        `;

        container.appendChild(step);
        
        // Animación de aparición
        setTimeout(() => {
          step.classList.add('visible');
        }, index * 150);
      });
    }

    function actualizarBarraProgreso(hitos) {
      const totalHitos = hitos.length;
      const completados = hitos.filter(h => 
        h.estado?.toLowerCase() === 'completado' || 
        h.estado?.toLowerCase() === 'completed'
      ).length;

      const porcentaje = Math.round((completados / totalHitos) * 100) || 0;
      document.getElementById('progress-percent').textContent = `${porcentaje}%`;
      document.getElementById('progress-fill').style.width = `${porcentaje}%`;

      const progressText = document.getElementById('progress-text');
      if (porcentaje === 0) {
        progressText.textContent = 'El proceso comenzará una vez completado el registro y pago.';
      } else if (porcentaje < 50) {
        progressText.textContent = '¡Vamos bien! Estamos en las primeras etapas del proceso.';
      } else if (porcentaje < 100) {
        progressText.textContent = '¡Vas muy bien! Estamos avanzando según lo planeado.';
      } else {
        progressText.textContent = '¡Felicidades! Has completado todo el proceso.';
      }
    }

    async function sendMessage() {
      const chatInput = document.getElementById('chat-message');
      const message = chatInput.value.trim();

      if (!message || !clienteId) return;

      try {
        const msgId = 'msg-' + Date.now();
        const messagesContainer = document.getElementById('messages-container');

        // Mostrar mensaje localmente
        const msgEl = document.createElement('div');
        msgEl.className = 'message sent';
        msgEl.setAttribute('data-id', msgId);
        msgEl.innerHTML = `
          ${message}
          <span class="message-time">
            ${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
          </span>
        `;
        messagesContainer.appendChild(msgEl);
        mensajesCargados.add(msgId);
        scrollToBottom();

        // Enviar al servidor
        socket.emit('mensaje-cliente', {
          clienteId: clienteId,
          texto: message,
          fecha: new Date().toISOString()
        }, (response) => {
          if (response.status === 'error') {
            console.error('Error del servidor:', response.error);
            mostrarError("No se pudo enviar el mensaje");
          } else if (response._id) {
            const localMsg = document.querySelector(`[data-id="${msgId}"]`);
            if (localMsg) {
              localMsg.setAttribute('data-id', response._id);
              mensajesCargados.delete(msgId);
              mensajesCargados.add(response._id);
            }
          }
        });

        await fetch(`https://proyect2-1.onrender.com/mensajes/${clienteId}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            autor: 'cliente',
            texto: message,
            fecha: new Date().toISOString()
          })
        });

        chatInput.value = '';
        scrollToBottom();
      } catch (err) {
        console.error('Error al enviar mensaje:', err);
        mostrarError("Error al enviar mensaje");
      }
    }

    // UI Initialization
    document.addEventListener('DOMContentLoaded', () => {
      setupNavigation();
      setupChat();
      setupFileModal();
      cargarDependientesGuardados();

      // Ocultar mensaje de bienvenida
      setTimeout(() => {
        const welcomeBox = document.getElementById('welcome-box');
        if (welcomeBox) welcomeBox.classList.add('fade-out');
      }, 3000);

      // Cargar datos reales
      if (clienteId) {
        cargarDatosDelCliente().then(cliente => {
          if (cliente) {
            cargarMensajesDelCliente(cliente.id);
            cargarProgresoDelCliente(cliente.id);
            cargarPagosCliente(cliente);
          }
        });
      }
    });

    function setupNavigation() {
      const navItems = document.querySelectorAll('.nav-item');
      const mobileTitle = document.getElementById('mobile-title');
      const titles = {
        chat: 'Chat con Asesor',
        info: 'Mi Información',
        documentos: 'Mis Documentos',
        progreso: 'Progreso del Caso',
        dependientes: 'Dependientes',
        pagos: 'Plan de Pagos'
      };
      
      navItems.forEach(item => {
        item.addEventListener('click', function() {
          navItems.forEach(navItem => navItem.classList.remove('active'));
          this.classList.add('active');
          
          const view = this.getAttribute('data-view');
          document.querySelectorAll('.content-panel').forEach(panel => {
            panel.classList.remove('active');
          });
          
          if (view) {
            document.getElementById(`vista-${view}`).classList.add('active');
            mobileTitle.textContent = titles[view];
          }
          
          // Cerrar menú en móvil
          sidebar.classList.remove('active');
          sidebarOverlay.classList.remove('active');
          
          if (view === 'chat') {
            scrollToBottom();
          }
          if (view === 'documentos') {
            cargarArchivosDelCliente(clienteId);
          }
          if (view === 'progreso') {
            cargarProgresoDelCliente(clienteId);
          }
          if (view === 'pagos') {
            cargarDatosDelCliente();
          }
        });
      });
    }

    function setupChat() {
      const sendBtn = document.getElementById('send-btn');
      const chatInput = document.getElementById('chat-message');
      
      sendBtn.addEventListener('click', sendMessage);
      chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessage();
      });
    }

    function setupFileModal() {
      const fileBtn = document.getElementById('file-btn');
      const fileInput = document.getElementById('file-input');
      const dropArea = document.getElementById('drop-area');
      const btnSelectFile = document.querySelector('.btn-select-file');
      const btnCancel = document.querySelector('.btn-cancel');
      const btnSend = document.querySelector('.btn-send');
      const modal = document.getElementById('file-modal');
      const closeModal = document.querySelector('.close-modal');
      
      fileBtn.addEventListener('click', () => modal.style.display = 'block');
      closeModal.addEventListener('click', () => modal.style.display = 'none');
      btnCancel.addEventListener('click', () => modal.style.display = 'none');
      btnSelectFile.addEventListener('click', () => fileInput.click());
      
      fileInput.addEventListener('change', handleFileSelect);
      
      // Drag and Drop Handlers
      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, preventDefaults, false);
      });
      
      ['dragenter', 'dragover'].forEach(eventName => {
        dropArea.addEventListener(eventName, highlight, false);
      });
      
      ['dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, unhighlight, false);
      });
      
      dropArea.addEventListener('drop', handleDrop, false);
      
      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }
      
      function highlight() {
        dropArea.classList.add('highlight');
      }
      
      function unhighlight() {
        dropArea.classList.remove('highlight');
      }
      
      function handleDrop(e) {
        const files = e.dataTransfer.files;
        handleFiles(files);
      }
      
      function handleFileSelect(e) {
        handleFiles(e.target.files);
      }
      
      function handleFiles(files) {
        if (!files.length) return;
        const file = files[0];
        const filePreview = document.getElementById('file-preview');

        if (file.type.startsWith('image/')) {
          const reader = new FileReader();
          reader.onload = function(e) {
            filePreview.innerHTML = `
              <div class="preview-image">
                <img src="${e.target.result}" alt="Preview">
                <p>${file.name}</p>
              </div>
            `;
            btnSend.disabled = false;
          };
          reader.readAsDataURL(file);
        } else {
          filePreview.innerHTML = `
            <div class="preview-file">
              <i class="fas fa-file"></i>
              <p>${file.name}</p>
              <small>${(file.size / 1024).toFixed(2)} KB</small>
            </div>
          `;
          btnSend.disabled = false;
        }
      }
      
      btnSend.addEventListener('click', () => {
        mostrarNotificacion('Archivo enviado con éxito');
        modal.style.display = 'none';
        document.getElementById('file-preview').innerHTML = '';
        btnSend.disabled = true;
      });
    }

    function mostrarNotificacion(mensaje) {
      const notificacion = document.createElement('div');
      notificacion.style.position = 'fixed';
      notificacion.style.bottom = '20px';
      notificacion.style.left = '50%';
      notificacion.style.transform = 'translateX(-50%)';
      notificacion.style.backgroundColor = 'var(--success)';
      notificacion.style.color = 'white';
      notificacion.style.padding = '12px 24px';
      notificacion.style.borderRadius = '8px';
      notificacion.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
      notificacion.style.zIndex = '1000';
      notificacion.style.animation = 'slideUp 0.3s ease';
      notificacion.innerHTML = `
        <i class="fas fa-check-circle"></i> ${mensaje}
      `;
      
      document.body.appendChild(notificacion);
      
      setTimeout(() => {
        notificacion.style.animation = 'fadeOut 0.5s ease';
        setTimeout(() => notificacion.remove(), 500);
      }, 3000);
    }

    // Dependientes
    let dependientes = [];

    function agregarDependiente() {
      const nombre = document.getElementById('dep-nombre').value.trim();
      const fecha = document.getElementById('dep-fecha').value;
      const alien = document.getElementById('dep-alien').value.trim();

      if (!nombre || !fecha || !alien) {
        mostrarError('Por favor completa todos los campos');
        return;
      }

      const nuevoDep = { 
        nombre, 
        fechaNacimiento: fecha, 
        alien,
        fechaRegistro: new Date().toISOString()
      };

      dependientes.push(nuevoDep);
      localStorage.setItem('dependientes_' + clienteId, JSON.stringify(dependientes));
      renderizarDependientes();
      mostrarNotificacion('Dependiente agregado');

      // Limpiar el formulario
      document.getElementById('dep-nombre').value = '';
      document.getElementById('dep-fecha').value = '';
      document.getElementById('dep-alien').value = '';
    }

    function renderizarDependientes() {
      const lista = document.getElementById('dependientes-lista');
      lista.innerHTML = '';

      if (dependientes.length === 0) {
        lista.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-users-slash"></i>
            <p>No has agregado dependientes aún</p>
          </div>
        `;
        return;
      }

      dependientes.forEach((dep, index) => {
        const item = document.createElement('div');
        item.className = 'dependiente-item';
        item.style.animationDelay = `${index * 0.1}s`;
        
        item.innerHTML = `
          <div class="dependiente-info">
            <span class="dependiente-nombre">${dep.nombre}</span>
            <span class="dependiente-details">
              Nacimiento: ${new Date(dep.fechaNacimiento).toLocaleDateString()} • Alien: ${dep.alien}
            </span>
          </div>
          <button class="btn-icon" onclick="eliminarDependiente(${index})" title="Eliminar dependiente">
            <i class="fas fa-trash-alt"></i>
          </button>
        `;

        lista.appendChild(item);
      });
    }

    function eliminarDependiente(index) {
      if (confirm('¿Eliminar este dependiente?')) {
        dependientes.splice(index, 1);
        localStorage.setItem('dependientes_' + clienteId, JSON.stringify(dependientes));
        renderizarDependientes();
        mostrarNotificacion('Dependiente eliminado');
      }
    }

    function cargarDependientesGuardados() {
      const guardados = localStorage.getItem('dependientes_' + clienteId);
      if (guardados) {
        dependientes = JSON.parse(guardados);
        renderizarDependientes();
      }
    }

    function subirComprobante(clienteId, indexPago) {
      const input = document.getElementById(`comprobante-${indexPago}`);
      if (!input || !input.files[0]) {
        mostrarError('Selecciona un archivo primero');
        return;
      }

      const formData = new FormData();
      formData.append("archivo", input.files[0]);
      formData.append("pagoId", indexPago);
      formData.append("clienteId", clienteId);

      fetch('https://proyect2-1.onrender.com/pagos/comprobante', {
        method: 'POST',
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        mostrarNotificacion('Comprobante enviado con éxito');
        cargarDatosDelCliente(); // Recargar datos
      })
      .catch(err => {
        console.error("Error al subir comprobante:", err);
        mostrarError("Hubo un problema al enviar el comprobante");
      });
    }
  </script>
</body>
</html>
